#!/usr/bin/env ruby

require "fileutils"
require "optparse"
require "bundler/setup"
require_relative "../system/boot"

options = {
  clean: true,
}

OptionParser.new do |opts|
  opts.banner = "Usage: bin/build [options]"

  opts.on("--[no-]clean", "Clean build directory (default: true)") do |v|
    options[:clean] = v
  end
end.parse!

if options[:clean]
  export_dir = Site::Container.config.root.join(Site::Container[:settings].export_dir)
  FileUtils.rm_rf(export_dir, secure: true)
  FileUtils.mkdir_p(export_dir)
end

Site::Container.build
