#!/bin/sh

set -e

echo "Building site..."
export PATH="$HOME/.local/share/gem/ruby/3.4.0/bin:$PATH"
bundle exec ./bin/build

echo "Committing build changes..."
git add build
if git diff --cached --quiet; then
  echo "No changes to deploy"
  exit 0
fi

git commit -m "ðŸš€ deploy: update site build"

echo "Deploying to gh-pages..."
if ! git subtree push --prefix build origin gh-pages; then
  echo "Deployment failed. This usually means gh-pages has diverged."
  echo "You can force update by running:"
  echo "  git push origin :gh-pages"
  echo "  git subtree push --prefix build origin gh-pages"
  exit 1
fi

echo "âœ… Deployment successful!"
echo "Site will be live at https://aikido-poa.pl/ in a few minutes"
